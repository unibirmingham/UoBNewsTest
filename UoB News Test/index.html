<!DOCTYPE html>
<html>
<head>
    <title>Kendo UI</title>
    <meta charset="UTF-8" />

    <link href="kendo/styles/kendo.mobile.all.min.css" rel="stylesheet" />


    <link href="styles/main.css" rel="stylesheet" />

    <script src="cordova.js"></script>
    <script src="kendo/js/jquery.min.js"></script>
    <script src="kendo/js/kendo.mobile.min.js"></script>
    <script type="text/javascript" src="Plugins/GAPlugin-master/www/GAPlugin.js"></script>

<script type="text/javascript">
                        var gaPlugin;
                
                        function initialize() {
                            document.addEventListener("deviceready", onDeviceReady, true);
                        }
                
                        function onDeviceReady() {
                                gaPlugin = window.plugins.gaPlugin;
                                
                                // Note: A request for permission is REQUIRED by google. You probably want to do this just once, though, and remember the answer for subsequent runs.
                                navigator.notification.confirm('GA_PLUGIN would like your permission to collect usage data. No personal or user identifiable data will be collected.', permissionCallback, 'Attention', ['Allow','Deny']);
                            
                        }
                
                        function permissionCallback (button) {
                                if (button === 1)
                                        gaPlugin.init(nativePluginResultHandler, nativePluginErrorHandler, "UA-47250154-1", 10);
                        }

                        function nativePluginResultHandler (result) {
                                //alert('nativePluginResultHandler - '+result);
                                console.log('nativePluginResultHandler: '+result);

                        }
        
                        function nativePluginErrorHandler (error) {
                                //alert('nativePluginErrorHandler - '+error);
                                console.log('nativePluginErrorHandler: '+error);
                        }
                        
                        function TrackButtonClicked() {
                                gaPlugin.trackEvent( nativePluginResultHandler, nativePluginErrorHandler, "Button", "Click", "event only", 1);
                        }
        
                        function VariableButtonClicked() {
                                // Set a dimension based on index and value. Make sure you have added a dimension in the GA dashboard to the
                                // default property for the passed in index, and your desired scope. GA allows up to 20 dimensions for a free account
                                gaPlugin.setVariable( nativePluginResultHandler, nativePluginErrorHandler, 1, "Purple");

                                // dimensions are are passed to the next event sent to GA. go ahead and fire off an event with the label (key) of your choice
                                // In this example, the label for custom dimension 1 will show up in the dashboard as "favoriteColor". This is much more efficent
                                // than the old custom variable method introduced in V1, (plus you get 20 free dimensions vs 5 free custom variables)
                                gaPlugin.trackEvent( nativePluginResultHandler, nativePluginErrorHandler, "event with variable", "set variable", "favoriteColor", 1);
                        }
        
                        function PageButtonClicked() {
                                gaPlugin.trackPage( nativePluginResultHandler, nativePluginErrorHandler, "some.url.com");
                        }
                        function ScreenButtonClicked(page) {
                                gaPlugin.trackPage( nativePluginResultHandler, nativePluginErrorHandler, page);
                        }
                        
                        function goingAway() {
                                gaPlugin.exit(nativePluginResultHandler, nativePluginErrorHandler);
                        }
    
    function eventListViewPullWithEndless(e) {
        var dataSource = new kendo.data.DataSource({
            transport: {
                read: {
                    url: "http://www.birmingham.ac.uk/web_services/Events.svc/?folderPath=/events",
                    dataType: "json"
                }
            },
           
            serverPaging: true,
            pageSize: 40
        });

        $("#pull-eventslistview").kendoMobileListView({
            dataSource: dataSource,
            template: $("#events-template").text(),
            pullToRefresh: true,
            endlessScroll: true
        });
        var eventsList = $('#pull-eventslistview').data('kendoMobileListView');
        eventsList.dataSource.read();
        eventsList.refresh();

    }
                        
                </script>
</head>

<body onload="initialize();" onunload="goingAway();">
    
    <!--Home-->
    <div id="tabstrip-home"
        data-role="view"
        data-title="Home">

        <div class="view-content">
            <h1>Welcome!</h1>
            <a id="skin-change" data-role="button" data-click="app.changeSkin">Flat</a>
            <p>
                Icenium&trade; enables you to build cross-platform device applications regardless of your
                    development platform by combining the convenience of a local development toolset with the
                    power and flexibility of the cloud.
            </p>
            <div class="img"></div>
        </div>
    </div>
    
    <div id="tabstrip-weather"
        data-role="view"
        data-title="Weather"
        data-model="app.weatherService.viewModel">

        <div class="weather">
            <p class="weather-title">20-Day Forecast</p>

            <div class="separator">
                <div class="dark"></div>
                <div class="light"></div>
            </div>

            <ul class="forecast-list"
                data-role="listview"
                data-bind="source: weatherDataSource"
                data-template="weather-forecast-template">
            </ul>
        </div>
    </div>
    
    <!--Weather forecast template-->
    <script type="text/x-kendo-tmpl" id="weather-forecast-template">
        <div>
            <div class="position-left">
                <span class="weather-info date">${day}</span>
            </div>
            <div class="position-right">
                <span class="weather-info temperature high">${highTemperature}<sup>&deg;</sup></span>
                <span class="weather-info temperature low">${lowTemperature}<sup>&deg;</sup></span>
            </div>
            <div class="position-center">
                <span class="weather-icon ${image}"></span>
            </div>
        </div>
    </script>
    
<!--Layout-->
    <div data-role="layout" data-id="tabstrip-layout">

        <!--Header-->
        <div data-role="header">
            <div data-role="navbar">
                <span data-role="view-title"></span>
            </div>
        </div>

        <!--Footer-->
        <div data-role="footer">
            <div data-role="tabstrip">
                <a href="#tabstrip-home" data-icon="home" onclick="ScreenButtonClicked('Home');">Home</a>
                <!--<a href="#tabstrip-login" data-icon="contacts">Login</a>-->
                <a href="#tabstrip-events" data-icon="recents" onclick="ScreenButtonClicked('Events');">Events</a>
                <a href="#tabstrip-weather" data-icon="globe" onclick="ScreenButtonClicked('Weather');">Weather</a>
            </div>
        </div>
    </div>    

    
        
        <div id="tabstrip-events" data-role="view" data-init="eventListViewPullWithEndless" data-title="Events">
            <!--<header data-role="header">
            <div data-role="navbar">
                <span data-role="view-title"></span>
            </div>
            </header>-->
            <ul id="pull-eventslistview" class="events-list"></ul>
         </div>
        
        

        <!--Events template-->
    <script type="text/x-kendo-tmpl" id="events-template">
        <!--<div>
            <div class="position-left">
                <span class="event-info title">${Title}</span>
            </div>
            <div class="position-center">
                <span class="event-icon ${EventImageUrl}"></span>
            </div>
        </div>-->
        <div class="event-item">        
            <h3>#:Title#</h3>
            <p>text here</p>
        </div>
    </script>
    

    
    <script src="scripts/weather.js"></script>
    <!--<script src="scripts/events.js"></script>-->
    <!--<script src="scripts/app.js"></script>-->
<script>
    app.application = new kendo.mobile.Application(document.body, { layout: "tabstrip-layout"});
</script>
</body>
</html>